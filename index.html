<!doctype html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Plona</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAAD/AAAADQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAP8AAAAAAAAAAAAAAP0AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA8QAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADvAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAACfAAAA/wAAAPMAAAAAAAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAnwAAAP8AAAC/AAAAAAAAAP8AAAB/AAAAtwAAAP8AAAD/AAAAnwAAAP8AAAD/AAAA/wAAAAAAAAAAAAAAAAAAAJ8AAAD/AAAAvwAAAAAAAAD/AAAAwwAAAIsAAAD/AAAA1wAAAEsAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAACfAAAA/wAAAL8AAAAAAAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAnwAAAP8AAAC/AAAAAAAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAAAAAAAAAAAAAAAAAJ8AAAD/AAAAvwAAAAAAAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAACfAAAA/wAAAO8AAAAAAAAA/wAAAPMAAACfAAAAnwAAAP8AAACfAAAA/wAAAPMAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAALEAAAAAAAAA4wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAKEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAz/MAAM/zAAAAAAAAAAAAADi+AAA4oAAAOIIAADi+AAA4gAAAOL4AADiAAAAAAAAAgAEAAP//AAD//wAA//8AAA==" />
<link rel="stylesheet" href="klawisze-ciemne.css">
<style>
body {font-size:15px;font-family:verdana; margin:0.5rem; background-color:#00080f; color:#f8f8f8;}
h3 span{color:#ddd;}
#info {margin:0.3rem 0; padding:0.3rem 1rem; min-height:1.5rem; border:1px solid #000; background-color:#222;} 
.div_klawiszy {margin-top:1rem;}
#mpc_update	{margin:1em 2em; padding:1em;background:white; color:black;font-family: monospace;font-size: 12px;}
#config_input {width:15.5em;}
input {font-size:1.2em; padding:4px;margin:4px;}
div.configs, div#klawisze {clear:both;display:block;}
button.vol {background:#123; float:left; height:2.3rem;}	
button.glos {font-size:1.5em; padding:0 1rem;}	

@media screen and (max-width: 570px) {
	#info {min-height:2.25rem;}
	button {width: 6rem;}
	button,button.admin {max-width:initial; min-width:initial; width: 153px; height:36px; margin:6px 8px; padding:0 2px;}
	button.admin {max-width:initial; min-width:initial; width: initial;}
	button.vol {width:4.5rem;}
	
}		
@media screen and (max-width: 390px) {
	#info {min-height:3.25rem;}
	button,button.admin {max-width:initial; min-width:initial; width: 133px; height:36px; margin:6px 8px; padding:0 2px;}
	button.admin {max-width:initial; min-width:initial; width: initial;}
	button.right{margin-right:0.5em;}
	button.vol {width:3.5rem;}

}   
</style>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script>
var radios = 
[
    {
        "title": "TOK FM",
        "stream": "http://poznan5-1.radio.pionier.net.pl:8000/radiotok.ogg",
        "stream2": "http://poznan5-1.radio.pionier.net.pl:8000/radiotok.ogg"
    },
    {
        "title": "RMF Classic",
        "stream": "http://31.192.216.5:8000/rmf_classic"
    },
    {
        "title": "Jazz Ballads",
        "stream": "http://pub6.jazzradio.com:80/jr_jazzballads_aacplus?d1e1bfa0a67fafc4764954be"
    },
    {
        "title": "Piano Trios",
        "stream": "http://pub1.jazzradio.com:80/jr_pianotrios_aacplus?d1e1bfa0a67fafc4764954be"
    },
    {
        "title": "Vocal Legend",
        "stream": "http://pub1.jazzradio.com:80/jr_vocallegends_aacplus?d1e1bfa0a67fafc4764954be"
    },
    {
        "title": "Gypsy Jazz",
        "stream": "http://pub1.jazzradio.com:80/jr_gypsyjazz?d1e1bfa0a67fafc4764954be"
    },
    {
        "title": "Guitar Jazz",
        "stream": "http://pub6.jazzradio.com:80/jr_guitarjazz?d1e1bfa0a67fafc4764954be"
    },
    {
        "title": "Guitar Acoustic",
        "stream": "http://streaming.radionomy.com/Acoustic-Guitar"
    },
    {
        "title": "PR-1 Jedynka",
        "stream": "mms://stream.polskieradio.pl/program1"
    },
    {
        "title": "PR-2 Dwójka",
        "stream": "mms://stream.polskieradio.pl/program2"
    },
    {
        "title": "PR-3 Trójka",
        "stream": "mms://stream.polskieradio.pl/program3"
    },
    {
        "title": "PR-4 Czwórka",
        "stream": "mms://stream.polskieradio.pl/program4"
    },
    {
        "title": "Szczecin Radio",
        "stream": "http://stream4.nadaje.com:11986/prs.aac"
    },

    {
        "title": "Sax4Love",
        "stream": "http://streaming.radionomy.com/Sax4Love"
    },
    {
        "title": "Jazz APh",
        "stream": "http://50.7.173.162:8014/"
    },
    {
        "title": "Classical APh",
        "stream": "http://50.7.173.162:8012/"
    },
    {
        "title": "Smooth lounge",
        "stream": "http://listen.radionomy.com/the-smooth-lounge"
    },
    {
        "title": "Złote Przeboje",
        "stream": "http://mainstream.radioagora.pl/tuba9-1.mp3"
    },
    {
        "title": "PL-Smooth Jazz",
        "stream": "http://178.32.161.112:5700"
    },
    {
        "title": "PL - JAZZ",
        "stream": "http://91.121.92.167:8700"
    },
    {
        "title": "PL-Klasycznie",
        "stream": "http://91.121.92.167:8900"
    },
    {
        "title": "Niezapomniane",
        "stream": "http://178.32.161.112:9100"
    },
    {
        "title": "Najwieksze 80",
        "stream": "http://178.32.161.113:9200"
    },
    {
        "title": "Najpiękniejsze",
        "stream": "http://mp3.polskieradio.pl:8020"
    }
];

var config=[
{
		"title": "Orange",
		"protokol": "http://",
		"ip": "192.168.1.105",
		"port": "1956",
		"class": "active"
	}, {
		"title": "Malina",
		"protokol": "http://",
		"ip": "192.168.1.112",
		"port": "1956",
		"class": ""
	}, {
		"title": "Local",
		"protokol": "http://",
		"ip": "127.1.1.0",
		"port": "1956",
		"class": ""
	}, {
		"title": "WIZUT",
		"protokol": "http://",
		"ip": "82.145.72.175",
		"port": "1956",
		"class": ""
	}

]
var wybranyKomputer = 0;
var wybraneRadio=0;

	// DOM READY
	function onDeviceReady() {
		odczytajConfig();
		readRadios();
		if (localStorage.getItem("___pi___radio")) wybraneRadio = localStorage.getItem("___pi___radio");
			
			// Events for klawisze bash
			[].forEach.call(document.querySelectorAll('button.bash'), function(el) {
				el.addEventListener('click', function() {
					sendBashCommand(this);
				})
			})			
			//document.getElementById('klawiszON').addEventListener('click', radioOn, false);
			//document.getElementById('klawiszOFF').addEventListener('click', radioOn, false);
			//document.getElementById('volumeplus').addEventListener('dajInfoRadio("volume=+10",true)', false);
			//document.getElementById('volumehalf').addEventListener('dajInfoRadio("volume=50",true)', false);
			//document.getElementById('volumminus').addEventListener('dajInfoRadio("volume=-10",true)', false);
			ustawActive();
			getInfo();
			ustawDevices();
	}	// Dom ready
	

   function onLoad() {
        document.addEventListener("deviceready", onDeviceReady, false);

		try {if (device.uuid) {console.log(device.uuid);}	}
		catch(err) {onDeviceReady();}
		
	}


	function readRadios(){
		var klawisze = document.getElementById('klawisze');
		// Events for klawisze radia
		for (var a in radios){
			var klaw = document.createElement('button');
				klaw.innerHTML=radios[a]['title'];
				klaw.setAttribute('data-radio',parseInt(a)+1); 
				klaw.addEventListener('click', radioOn, false); 
			klawisze.appendChild(klaw);	
		}
		if (wybraneRadio != 0) dajInfoRadio('radio='+wybraneRadio);
		
	}


	// AJAX main AJAX main AJAX main AJAX main AJAX main
	function dajInfoRadio(param,opisz){
		
		document.getElementById('debug').innerHTML=param;
		try {
			var r = new XMLHttpRequest();
			var protokol = config[wybranyKomputer]['protokol'];
			var ip = config[wybranyKomputer]['ip'];
			var port = ':'+config[wybranyKomputer]['port'];
			r.open("GET", protokol+ip+port+"/?"+param, true);
			r.onreadystatechange = function () {
			document.getElementById('debug').innerHTML = r.status;
			if (r.readyState != 4 || r.status != 200) return;
				//console.log(r.responseText);
				document.getElementById('debug').innerHTML = r.responseText;
				var info = (JSON.parse(r.responseText));
				//console.log(info);
				var wpis='';
				if (info.wiadomosc && opisz==true) wpis += info.wiadomosc; //undefined
				document.getElementById('info').innerHTML = wpis;// +' '+ screen.width+'x'+screen.height;
			};
			r.send();
		}
		catch (error) {
			console.log(error);
		}
		finally {
			//console.log('daj info finally');
		}
		/document.getElementById('wybrane').innerHTML=radios[parseInt(wybraneRadio)-1]['title'];
	}

	function getInfo(){
		dajInfoRadio('info=radio',true);
		setTimeout(function(){getInfo();},10000);
	}
	
	function ustawActive(){
		[].forEach.call(document.querySelectorAll('#klawisze button'), function(el) {
			if (el.dataset.radio == wybraneRadio) el.className='active'; else el.className='';
		});
	}
	
	// włącz radio wg numeru
	function radioOn(){
		dataRadio = this.dataset.radio;	
		var intRadio = parseInt(dataRadio);
		document.getElementById('info').innerHTML = '';
		dajInfoRadio('radio='+dataRadio,false);
		setTimeout(function(){dajInfoRadio('info=radio',true);},8000);
		
		if(intRadio<0 || intRadio>900) return;
		wybraneRadio = dataRadio;
		localStorage.setItem("___pi___radio",wybraneRadio);
		document.getElementById('wybrane').innerHTML=radios[parseInt(wybraneRadio)-1]['title'];
		ustawActive();
	}
	
	function sendBashCommand(ten){
		var bash = ten.dataset.bash;
		bash = encodeURIComponent(bash);
		console.log(bash);
		dajInfoRadio('bash='+bash,false);
	}

	
// po kliknieciu w klawisz
function wybierzDev(d){
	wybranyKomputer = d;
	ustawDevices();
	localStorage.setItem("___radio___config", JSON.stringify(config));
}
	
function ustawDevices(){
	var iled = config.length;
	var devices = document.getElementById('devices');
	devices.innerHTML='';
//console.log(config);
	for (var d in config){
		var klasa='';
		if (d==wybranyKomputer) klasa ='active';
		config[d]['class']=klasa;
		devices.insertAdjacentHTML('beforeend','<button class="admin '+klasa+'" onClick=wybierzDev("'+d+'")>'+config[d]['title']+'</button>');
	}
	//document.getElementById('wybranyKomputer').innerHTML = config[wybranyKomputer]['title'];
}

function mpcUpdate(){
	var mpc_update = document.getElementById('mpc_update');
	mpc_update.style.display='block';
	mpc_update.innerHTML='';
	mpc_update.insertAdjacentHTML('beforeend','<button class="mini right" onClick=\'document.getElementById("mpc_update").style.display="none";\'>X</button><br />');
	mpc_update.insertAdjacentHTML('beforeend',"#!/bin/bash<br />");
	mpc_update.insertAdjacentHTML('beforeend',"mpc clear<br />");
	for (var r in radios){
		mpc_update.insertAdjacentHTML('beforeend',"mpc add "+radios[r]['stream']+'<br />');
	}
	mpc_update.insertAdjacentHTML('beforeend',"<br /><br/>");
}	

function odczytajConfig(){
	var odczyt = localStorage.getItem("___radio___config");
	if (odczyt){
		config = JSON.parse(odczyt);
		for(var c in config){
			if(config[c]['class']=='active') wybranyKomputer = c;
		}
	}
}

function zapiszConfig(){
	var configs = document.querySelectorAll('div#config_update div');
	var ilec = configs.length;
	for (var id=0; id<ilec; id++){
		var inputy = document.querySelectorAll('div#config'+id+' input');
		for (var i in inputy){
			var input = inputy[i];
			if (typeof(input) == 'object'){
				var key = (input.id.split('config'+id))[1];
				var val = input.value;
				config[id][key]=val;
			}
		}	
	}
	var zapisTXT = JSON.stringify(config);
	localStorage.setItem("___radio___config", zapisTXT);	
}


function configUpdate(){
console.log(config);
	var config_update = document.getElementById('config_update');	
	config_update.innerHTML='';
	config_update.style.display='block';
	for (var c in config){
		var conf = config[c];
		var id = 'config'+c;
		var newDiv = document.createElement('div');
			newDiv.id = id;
			newDiv.className="configs";
			newDiv.insertAdjacentHTML('beforeend','<input id="'+id+'title"    value="'+conf.title+'"    title="nazwa"    style="width:6em;" />');
			newDiv.insertAdjacentHTML('beforeend','<input id="'+id+'protokol" value="'+conf.protokol+'" title="protokol" style="width:3em;" />');
			newDiv.insertAdjacentHTML('beforeend','<input id="'+id+'ip"       value="'+conf.ip+'"       title="ip"       style="width:8em;" />');
			newDiv.insertAdjacentHTML('beforeend','<input id="'+id+'port"     value="'+conf.port+'"     title="port"     style="width:3em;" />');
		config_update.appendChild(newDiv);
	}
	var conf = config[0];
	config_update.insertAdjacentHTML('beforeend',"<button onClick='zapiszConfig()'>Zapisz config</button>");
	config_update.insertAdjacentHTML('beforeend','<button class="mini right" onClick=\'document.getElementById("config_update").style.display="none";\'>X</button>');
	config_update.insertAdjacentHTML('beforeend','<button class="mini right" onClick="resetConfig()">()</button>');
	
}	

function resetConfig(){
	localStorage.removeItem("___radio___config");
	location.reload();
}
</script>
</head>

<body onload="onLoad()">

	<h3 style="float:left;"><span style="font-family:Georgia;" id="wybranyKomputer">iR</span> PiRadio :: <span id="wybrane"></span></h3>

	<div style="clear:both; width:100%;">
		<button class="klaw admin vol glos" onClick="dajInfoRadio('radio=a')"><</button>
		<button class="klaw admin vol glos" onClick="dajInfoRadio('radio=z')">></button>
		<button class="klaw admin vol" onClick="dajInfoRadio('radio=0')"><b>Start</b></button>
		<button class="klaw admin vol" onClick="dajInfoRadio('radio=q')"><b>Stop</b></button>

		<button class="klaw admin vol" onClick="dajInfoRadio('radio=b')">25%</button>
		<button class="klaw admin vol" onClick="dajInfoRadio('radio=c')">50%</button>
		<button class="klaw admin vol" onClick="dajInfoRadio('radio=d')">75%</button>
		<button class="klaw admin vol" onClick="dajInfoRadio('radio=e')">90%</button>
	</div>

	<div id="klawisze"></div>
<!--	
	<div class="div_klawiszy">
		<button data-radio="999"  id="klawiszON"  class="plus">Włącz radio ON</button>
		<button data-radio="-1"   id="klawiszOFF" class="plus">Wyłącz radio OFF</button>
	</div>
	<div class="div_klawiszy">
		<button data-volume="+10"  id="volumeplus"  class="plus">V+10</button>
		<button data-volume="50"   id="volumehalf"  class="plus">V 50</button>
		<button data-volume="-10"  id="volumeminus" class="plus">V-10</button>
	</div>
	
	<div class="div_klawiszy">

		<button data-bash="mpc volume 25" class="bash admin">25%</button>
		<button data-bash="mpc volume 50" class="bash admin">50%</button>
		<button data-bash="mpc volume 75" class="bash admin">75%</button>
		<button data-bash="mpc volume 90" class="bash admin">90%</button>
		<button data-bash="mpc volume -10" class="bash admin">Ciszej</button>
		<button data-bash="mpc volume +10"  class="bash admin">Głośniej</button>
		<button data-bash="mpc stop" class="bash admin">Stop</button>
		<button data-bash="mpc play" class="bash admin">Play</button>
		
	</div>
		<div class="div_klawiszy">
		
		<button data-bash="shutdown now"  class="bash admin">Shutdown</button>
		<button data-bash="shutdown -r now" class="bash admin">Reboot</button>
		<button data-bash="shutdown -P now" class="bash admin">Power off</button>
	</div>
-->
	<div id="info"></div>
	
	<div class="div_klawiszy">
		<button class="klaw admin" onClick="mpcUpdate()">MPC update</button>
		<button class="klaw admin" onClick="configUpdate()">Config</button>
		<div id="config_update" style="display:none;"></div>
		<div id="mpc_update" style="display:none;"></div>
	</div>
<br />
	<div style="float:right;" id="devices"></div>
<br />
<div id="debug"></div>
<br />
</body>
</html>
